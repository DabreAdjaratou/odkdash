<style>
  
  .auditPointName{
	color:#fff;
	margin:0;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	max-width: 200px;
	vertical-align:top;
  }
  
  .auditPointName:hover{
	white-space: normal !important;
	overflow: visible;
	text-overflow: '';
  }
  
</style>
      <div class="am-content">
        <div class="main-content">
          <!--+general-chart("classes", "title", "height", "id", "counter value", "counter desc", tools enabled (use true or false))-->
          <div class="row">
            <div class="col-md-4">
              <div class="widget widget-pie">
                <div class="widget-head"><span class="title">SPI RT v3 Overall</span></div>
                <div class="row chart-container">
                  <div class="col-md-6">
					<canvas id="widget-top-1" style="width: 100%; height: 170px;;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legendOverall"></div>
                  </div>
                </div>
				<div class="row chart-info">
                  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perf1[0]['oldestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;padding-left:5px;;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perf1[0]['newestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perf1[0]['totalDataPoints']; ?></span></div>
                </div>				
              </div>
            </div>
            <div class="col-md-4">
              <div class="widget widget-pie widget-pie-stats">
                <div class="widget-head"><span class="title">SPI RT v3 Last 180 days</span></div>
                <div class="row chart-container">
                  <div class="col-md-6">
					    <canvas id="widget-top-3" style="width: 100%; height: 170px;;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legend180"></div>
                  </div>
                </div>
				<div class="row chart-info">
                  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perflast180[0]['oldestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;padding-left:5px;;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perflast180[0]['newestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perflast180[0]['totalDataPoints']; ?></span></div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="widget widget-pie">
                <div class="widget-head"><span class="title">SPI RT v3 Last 30 days</span></div>
                <div class="row chart-container">
                  <div class="col-md-6">
					<canvas id="widget-top-2" style="width: 100%; height: 170px;;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legend30"></div>
                  </div>
                </div>
				<div class="row chart-info">
                  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perflast30[0]['oldestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;padding-left:5px;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perflast30[0]['newestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perflast30[0]['totalDataPoints']; ?></span></div>
                </div>				
              </div>
            </div>			
          </div>
		  <div class="row">
			
			
			<div class="col-md-6">
			  <div class="widget widget-calendar">
				
                <div class="cal-container">
                  <div class="cal-notes">
					<h3 style="color:#fff;">Last 8 Audits</h3>
                    <ul>
					  <?php
					  $count = 0;
					  foreach($allSubmissions as $row) {
						if($count == 8) break;
					  ?>					  
						<li style="list-style:disc;margin-left:15px;color:#fff;">
						  <span class="auditPointName"><?php echo $row['facilityname']; ?></span>
						</li>
                      <?php
					  $count++;
					  }
					  ?>
                    </ul>
                  </div>
                  <div class="cal-calendar">
					<h3 style="">Audit Dates</h3>
                    <div class="ui-datepicker"></div>
                  </div>
                </div>
			</div>
		  </div>			
			
			
			<div class="col-md-6">
			  <div class="widget">
				<div class="widget-head">
				  <span class="title">Last 30 Audits</span>
				</div>
				<div class="chart-container">
				  <canvas id="audit-points-barchart"  style="width:100%;height:300px"></canvas>
				</div>
			  </div>
			</div>

		  </div>
          <div class="row">
			
			<div class="col-md-6">
                  <div class="widget widget-radar widget-pie">
                    <div class="widget-head">
                      <span class="title">Audit Performance</span>
                    </div>
                    <div class="chart-container">
                      <canvas id="radar-chart1" height="180px"></canvas>
                    </div>
					<div class="row chart-info">
					  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perf1[0]['oldestDate']) ?></span></div>
					  <div class="col-xs-4" style="text-align:center;padding-left:5px;;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perf1[0]['newestDate']) ?></span></div>
					  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perf1[0]['totalDataPoints']; ?></span></div>
					</div>					
                  </div>
				  
			</div>			
			
            <div class="col-md-6">
              <div class="widget widget-map">
                <div class="widget-head"><span class="title">Audit Locations</span></div>
                <div class="map-container">
                  <div class="gmap" id="gmap" style="height: 410px;"></div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhZa4hDifE6p2sbaxJehS7gcrZOJScIqM&libraries=drawing,geometry,places">
</script>
<script src="<?php echo $this->basePath('assets/js/maplace.min.js'); ?>" type="text/javascript"></script>
    <script type="text/javascript">
      
      var color1 = "red";
      var color2 = "orange";
      var color3 = "yellow";
      var color4 = "#8DD63E";
      var color5 = "#528A16";

  //Get the template css colors into js vars
  function getColor( c ){
    var tmp = $("<div>", { class: c }).appendTo("body");
    var color = tmp.css("background-color");
    tmp.remove();

    return color;
  }
  
		var colors = {};
		colors.primary = getColor('clr-primary');
        colors.success = getColor('clr-success');
        colors.info    = getColor('clr-info');
        colors.warning = getColor('clr-warning');
        colors.danger  = getColor('clr-danger');
        colors.alt1    = getColor('clr-alt1');
        colors.alt2    = getColor('clr-alt2');
        colors.alt3    = getColor('clr-alt3');
        colors.alt4    = getColor('clr-alt4');
      
function widget_top_1(){


		<?php
		
			$perf1[0]['level0'] = ($perf1[0]['level0'] > 0) ? $perf1[0]['level0'] : 0;
			$perf1[0]['level1'] = ($perf1[0]['level1'] > 0) ? $perf1[0]['level1'] : 0;
			$perf1[0]['level2'] = ($perf1[0]['level2'] > 0) ? $perf1[0]['level2'] : 0;
			$perf1[0]['level3'] = ($perf1[0]['level3'] > 0) ? $perf1[0]['level3'] : 0;
			$perf1[0]['level4'] = ($perf1[0]['level4'] > 0) ? $perf1[0]['level4'] : 0;
		
	  	?>	  		    
			
	  var data = [
		 {
		  value: <?php echo $perf1[0]['level0']; ?>,
		  color: color1,
		  label: "Level 0 (Below 40)"
	  },
		 {
		  value: <?php echo $perf1[0]['level1']; ?>,
		  color: color2,
		  label: "Level 1 (40-59)"
	  },
		 {
		  value: <?php echo $perf1[0]['level2']; ?>,
		  color: color3,
		  label: "Level 2 (60-79)"
	  },
		 {
		  value: <?php echo $perf1[0]['level3']; ?>,
		  color: color4,
		  label: "Level 3 (80-89)"
	  },
		 {
		  value: <?php echo $perf1[0]['level4']; ?>,
		  color: color5,
		  label: "Level 4 (90 and above)"
	  },
	  
	  
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		  animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  tooltipTemplate: "<%= value %>",
		  legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'

	  }
	  
	  var ctx = document.getElementById("widget-top-1").getContext("2d");
	  
	  var myChart = new Chart(ctx).Pie(data, options);
	  
	  
	  document.getElementById('legendOverall').innerHTML = myChart.generateLegend();	  
	  
        
        
    }
    
    function widget_top_2(){
		<?php
		
			$perflast30[0]['level0'] = ($perflast30[0]['level0'] > 0) ? $perflast30[0]['level0'] : 0;
			$perflast30[0]['level1'] = ($perflast30[0]['level1'] > 0) ? $perflast30[0]['level1'] : 0;
			$perflast30[0]['level2'] = ($perflast30[0]['level2'] > 0) ? $perflast30[0]['level2'] : 0;
			$perflast30[0]['level3'] = ($perflast30[0]['level3'] > 0) ? $perflast30[0]['level3'] : 0;
			$perflast30[0]['level4'] = ($perflast30[0]['level4'] > 0) ? $perflast30[0]['level4'] : 0;
		
	  	?>
			
	  var data = [
		 {
		  value: <?php echo $perflast30[0]['level0']; ?>,
		  color: color1,
		  label: "Level 0 (Below 40)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level1']; ?>,
		  color: color2,
		  label: "Level 1 (40-59)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level2']; ?>,
		  color: color3,
		  label: "Level 2 (60-79)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level3']; ?>,
		  color: color4,
		  label: "Level 3 (80-89)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level4']; ?>,
		  color: color5,
		  label: "Level 4 (90 and above)"
	  },
	  
	  
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		      animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  percentageInnerCutout: 50,
		  tooltipTemplate: "<%= value %>",
		      legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'

	  }
	  
	  var ctx = document.getElementById("widget-top-2").getContext("2d");
	  
	  var myChart = new Chart(ctx).Doughnut(data, options);
	  
	  
	  document.getElementById('legend30').innerHTML = myChart.generateLegend();	  
	  
	  
    }
    
    function widget_top_3(){
			

		<?php
		
			$perflast180[0]['level0'] = ($perflast180[0]['level0'] > 0) ? $perflast180[0]['level0'] : 0;
			$perflast180[0]['level1'] = ($perflast180[0]['level1'] > 0) ? $perflast180[0]['level1'] : 0;
			$perflast180[0]['level2'] = ($perflast180[0]['level2'] > 0) ? $perflast180[0]['level2'] : 0;
			$perflast180[0]['level3'] = ($perflast180[0]['level3'] > 0) ? $perflast180[0]['level3'] : 0;
			$perflast180[0]['level4'] = ($perflast180[0]['level4'] > 0) ? $perflast180[0]['level4'] : 0;
		
	  	?>	  		
			
	  var data = [
		 {
		  value: <?php echo $perflast180[0]['level0']; ?>,
		  color: color1,
		  label: "Level 0 (Below 40)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level1']; ?>,
		  color: color2,
		  label: "Level 1 (40-59)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level2']; ?>,
		  color: color3,
		  label: "Level 2 (60-79)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level3']; ?>,
		  color: color4,
		  label: "Level 3 (80-89)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level4']; ?>,
		  color: color5,
		  label: "Level 4 (90 and above)"
	  },
	  
	  
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		      animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  percentageInnerCutout: 50,
		  tooltipTemplate: "<%= value %>",
		      legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'

	  }
	  
	  var ctx = document.getElementById("widget-top-3").getContext("2d");
	  
	  var myChart = new Chart(ctx).Doughnut(data, options);
	  
	  
	  document.getElementById('legend180').innerHTML = myChart.generateLegend();	  
	  
	  
    }
    
	

    function bar_chart(){

			  Chart.types.Bar.extend({
			  name: "BarAlt",
			  initialize: function (data) {
				  Chart.types.Bar.prototype.initialize.apply(this, arguments);
				  var xLabels = this.scale.xLabels
				  xLabels.forEach(function (label, i) {
						  xLabels[i] = '';
				  })
			  }
			  });
			  
					<?php
					  $counter = 0;
					  $barData = array();
					  $labNameData = array();
					  foreach($allSubmissions as $row) {
						if($counter == 30) break;
						$barData[] = round($row['AUDIT_SCORE_PERCANTAGE'],2); 
						$labNameData[] = ("'Date : ".$this->humanDateFormat($row['today'])."' + ' ' + 'Facility Name : ".addslashes($row['facilityname'])."' + ' Audit Score ' "); 
						$counter++;
					  }
					?>	

      var barData = {
		  labels: [<?php echo implode(",",$labNameData); ?>],
		  datasets: [
			  {
				  label: 'Last 30 Audits',
				  fillColor: colors.primary,
				  data: [<?php echo implode(",",$barData); ?>]
			  }
		  ]
	  };
	  

	  var ctx = document.getElementById('audit-points-barchart').getContext('2d');
	  var myBarChart = new Chart(ctx).BarAlt(barData,{
							responsive: true
						});	  
	  
	  
    }	

function radar_chart(){

      var color1 = tinycolor( colors.primary ).lighten( 6 );
      var color2 = tinycolor( colors.alt4 ).lighten( 6.5 );
      var color3 = tinycolor( colors.success ).lighten( 6.5 );
      var color4 = tinycolor( colors.info ).lighten( 6.5 );
      var color5 = tinycolor( colors.warning ).lighten( 6.5 );
      var color6 = tinycolor( colors.danger ).lighten( 6.5 );
      var color7 = tinycolor( colors.alt1 ).lighten( 6.5 );
      var color8 = tinycolor( colors.alt2 ).lighten( 6.5 );
      var color9 = tinycolor( colors.alt3 ).lighten( 6.5 );

      var data = {
        labels: ["Personnel Training & Certification", "Physical", "Safety", "Pre-Testing", "Testing", "Post Testing Phase", "External Quality Audit"],
        datasets: [
		  <?php
		  $colorCounter = 1;
		  foreach ($auditRoundWiseData as $auditNo => $adata){ ?>
          {
            label: "Audit Round No. <?php echo $auditNo; ?>",
            fillColor: color<?php echo $colorCounter; ?>.setAlpha(.5).toString(),
            pointColor: color<?php echo $colorCounter; ?>.setAlpha(.8).toString(),
            strokeColor: color<?php echo $colorCounter; ?>.setAlpha(.8).toString(),
            highlightFill: color<?php echo $colorCounter; ?>.setAlpha(.75).toString(),
            highlightStroke: color<?php echo $colorCounter; ?>.toString(),
            data: [
				   <?php echo $adata['PERSONAL_SCORE'] ?>,
				   <?php echo $adata['PHYSICAL_SCORE'] ?>,
				   <?php echo $adata['SAFETY_SCORE'] ?>,
				   <?php echo $adata['PRETEST_SCORE'] ?>,
				   <?php echo $adata['TEST_SCORE'] ?>,
				   <?php echo $adata['POST_SCORE'] ?>,
				   <?php echo $adata['EQA_SCORE'] ?>,
				   ]
          },
		  <?php
		  $colorCounter++;
		  if($colorCounter > 9){
			$colorCounter = 1;
		  }
		  } ?>
        ]
      };

      var radarChart = new Chart( $("#radar-chart1").get(0).getContext("2d") ).Radar(data, {
        scaleShowLine : true,
        responsive: true,
        maintainAspectRatio: true,
        legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"
      });
    }

//Calendar Widget
    function calendar_widget(){
    	var widget = $(".widget-calendar");
    	var calNotes = $(".cal-notes", widget);
    	var calNotesDay = $(".day", calNotes);
    	var calNotesDate = $(".date", calNotes);

    	//Calculate the weekday name
    	var d = new Date();
		var weekday = new Array(7);
		weekday[0]=  "Sunday";
		weekday[1] = "Monday";
		weekday[2] = "Tuesday";
		weekday[3] = "Wednesday";
		weekday[4] = "Thursday";
		weekday[5] = "Friday";
		weekday[6] = "Saturday";

		var weekdayName = weekday[d.getDay()];

		calNotesDay.html( weekdayName );

		//Calculate the month name
		var month = new Array();
		month[0] = "January";
		month[1] = "February";
		month[2] = "March";
		month[3] = "April";
		month[4] = "May";
		month[5] = "June";
		month[6] = "July";
		month[7] = "August";
		month[8] = "September";
		month[9] = "October";
		month[10] = "November";
		month[11] = "December";

		var monthName = month[d.getMonth()];
		var monthDay = d.getDate();

		calNotesDate.html( monthName + " " + monthDay);

      if (typeof jQuery.ui != 'undefined') {
        $( ".ui-datepicker" ).datepicker({
        	onSelect: function(s, o){
        		var sd = new Date(s);
        		var weekdayName = weekday[sd.getDay()];
        		var monthName = month[sd.getMonth()];
				var monthDay = sd.getDate();
				calNotesDay.html( weekdayName );
				calNotesDate.html( monthName + " " + monthDay);
				alert('Under Construction');
        	}
        });
      }
    }
	
function world_map(){

      var color = "#95D9F0";

      $('#gmap').vectorMap({
        map: 'world_mill_en',
        backgroundColor: 'transparent',
        
        regionStyle: {
          initial: {
            fill: color,
          },
          hover: {
            "fill-opacity": 0.8
          }
        },
        markerStyle:{
            initial:{
              r: 10
            },
             hover: {
              r: 12,
              stroke: 'rgba(255,255,255,0.8)',
              "stroke-width": 4
            }
          },
          markers: [
			 <?php foreach($allSubmissions as $row) { ?>
              {
				latLng: [<?php echo $row['Latitude'] ?>, <?php echo $row['Longitude'] ?>],
				name: '<?php echo addslashes($row['facilityname']); ?>',
				style: {
				  fill: '#F07878',
				  stroke:'rgba(255,255,255,0.7)',
				  "stroke-width": 3
				  }
			  },
			  <?php } ?>
              
          ]
      });
    }    
      
	  
	var LocsA = [
	  <?php foreach($allSubmissions as $row) {
		
		if(isset($row['Latitude']) && $row['Latitude'] != ""){
		
		?>
		{
			lat: <?php echo $row['Latitude'] ?>,
			lon: <?php echo $row['Longitude'] ?>,
			title: '<?php echo addslashes($row['facilityname']); ?>',
			html: '<strong><?php echo addslashes($row['facilityname']); ?></strong>',
			animation: google.maps.Animation.DROP
		},
	  <?php }
	  }?>
	];
	  
      
      $(document).ready(function(){
      	//initialize the javascript
        widget_top_1();
        widget_top_2();
        widget_top_3();
        radar_chart();
        calendar_widget();
		bar_chart();
		
		new Maplace({
		  locations: LocsA,
		  map_div: '#gmap',
	      controls_on_map: true,
		  map_options : {
			  mapTypeId: google.maps.MapTypeId.ROADMAP,
			  zoom: 6
		  }
		}).Load();
		

      });
    </script>