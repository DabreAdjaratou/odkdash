<link rel="stylesheet" type="text/css" href="<?php echo $this->basePath('assets/lib/select2/css/select2.min.css'); ?>"/>
<link rel="stylesheet" href="<?php echo $this->basePath('assets/css/jquery.multiselect.css'); ?>" type="text/css"/>
<script src="<?php echo $this->basePath('assets/js/jquery.multiselect.js'); ?>" type="text/javascript"></script>
<style>
  .auditPointName{
	color:#fff;
	margin:0;
	
	min-width: 200px;
	vertical-align:top;
  }
  
  .auditPointName:hover{
	white-space: normal !important;
	overflow: visible;
	text-overflow: '';
  }
  
  .event a {
    background-color: #8eaffe !important;
    background-image :none !important;
    color: #ffffff !important;
	border-radius:50%;
}


.highcharts-tooltip span {
    width:250px;
    overflow:auto;
    white-space:normal !important;
}

.select2{
  width:300px !important;
}
/*multiselect*/
/*.ui-state-hover, .ui-widget-content .ui-state-hover{color: #1c94c4;border: 1px solid #cccccc;background:none;}
.ui-state-active{color: #1c94c4;border: 1px solid #cccccc;background:none;}
.ui-multiselect-header{display: none;}
*/
.widget-calendar .cal-container .cal-calendar .ui-datepicker table.ui-datepicker-calendar tr td a.ui-state-highlight{
  background: none !important;
  color: #888;
  border:none;
}
.limitBar{width: 10%;color: #555;background-color: #fff;background-image: none;border: 1px solid #ccc;border-radius: 4px;padding: 1px;vertical-align: middle;}
  
</style>
<link rel="stylesheet" href="<?php echo $this->basePath('assets/css/jquery.multiselect.css'); ?>" type="text/css"/>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
<script src="<?php echo $this->basePath('assets/js/jquery.multiselect.js'); ?>" type="text/javascript"></script>
      <div class="am-content">
		<div class="page-head">
          <h2>SPI-RT 3.0 Checklist</h2>
        </div>
        <div class="main-content">
        
          <!--+general-chart("classes", "title", "height", "id", "counter value", "counter desc", tools enabled (use true or false))-->
          <div class="row">
            <div class="col-md-4">
              <div class="widget widget-pie">
                <div class="widget-head"><span class="title">SPI RT v3 Overall</span></div>
                <div class="row chart-container">
                  <div class="col-md-6">
					<canvas id="widget-top-1" style="width: 100%; height: 170px;;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legendOverall"></div>
                  </div>
                </div>
				<div class="row chart-info">
                  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perf1[0]['oldestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;padding-left:5px;;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perf1[0]['newestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perf1[0]['totalDataPoints']; ?></span></div>
                </div>				
              </div>
            </div>
            <div class="col-md-4">
              <div class="widget widget-pie widget-pie-stats">
                <div class="widget-head"><span class="title">SPI RT v3 Last 180 days</span></div>
                <div class="row chart-container">
                  <div class="col-md-6">
					    <canvas id="widget-top-3" style="width: 100%; height: 170px;;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legend180"></div>
                  </div>
                </div>
				<div class="row chart-info">
                  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perflast180[0]['oldestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;padding-left:5px;;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perflast180[0]['newestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perflast180[0]['totalDataPoints']; ?></span></div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="widget widget-pie">
                <div class="widget-head"><span class="title">SPI RT v3 Last 30 days</span></div>
                <div class="row chart-container">
                  <div class="col-md-6">
					<canvas id="widget-top-2" style="width: 100%; height: 170px;;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legend30"></div>
                  </div>
                </div>
				<div class="row chart-info">
                  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perflast30[0]['oldestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;padding-left:5px;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perflast30[0]['newestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perflast30[0]['totalDataPoints']; ?></span></div>
                </div>				
              </div>
            </div>			
          </div>
		  <div class="row">
			
			
			<div class="col-md-6">
			  <div class="widget widget-calendar">
				
                <div class="cal-container">
                  <div class="cal-calendar">
		    <h3 style="">Audit Dates</h3>
                    <div class="ui-datepicker"></div>
                  </div>
                </div>
			</div>
		  </div>			
			
			
			<div class="col-md-6">
			  <div class="widget">
				<div class="widget-head">
				  <span class="title">Last 30 Audits</span>
				</div>
				<div class="chart-container">
				  <div id="audit-points-barchart"  style="width:100%;height:300px"></div>
				</div>
			  </div>
			</div>

		  </div>
          <div class="row">
			
			<div class="col-md-6" id="lefter">
                  <div class="widget widget-radar widget-pie">
                    <div class="widget-head">
		      
                      <span class="title"><b>Audit Performance</b></span>
		      <label style="margin-left:5%;">Audit Round</label>
                      <select class="" id="auditRndNo" multiple="multiple" onchange="getAuditDetails()">
                          <?php
			  foreach($spiV3auditRoundNo as $auditRoundNo)
			  {
			    ?>
			    <option value="<?php echo $auditRoundNo['auditroundno'];?>"> <?php echo $auditRoundNo['auditroundno']." (".$auditRoundNo['rowCount'].")";?></option>
			    <?php
			  }
			  ?>
                        </select>
                    </div>
		      <div id="radarChart">
		      	
		    </div>
		  </div>
				  
                  <div class="widget widget-radar widget-pie">
                    <div class="widget-head">
                      <span class="title"><b>Worst Performing Questions</b></span>
		      <div style="margin-top:2%;">
		      <label style="margin-left:1%;">Audit Round</label>
                      <select class="" id="auditRndWorstNo" multiple="multiple" onchange="getAuditWorstDetails()">
                          <?php
			  foreach($spiV3auditRoundNo as $auditRoundNo)
			  {
			    ?>
			    <option value="<?php echo $auditRoundNo['auditroundno'];?>"> <?php echo $auditRoundNo['auditroundno']." (".$auditRoundNo['rowCount'].")";?></option>
			    <?php
			  }
			  ?>
                        </select>
		      <label style="margin-left: 1%;">Limit</label>
                      <select class="limitBar" style="" id="limitBar" onchange="getAuditWorstDetails()">
			<option value="5" selected="selected">5</option>
			<option value="10">10</option>
			<option value="15">15</option>
			<option value="20">20</option>
                        </select>
		      </div>
		    </div>
                    <div class="chart-container" id="zeroCountChart">
                      
                    </div>				
                  </div>
				  
			</div>			
			
            <div class="col-md-6" id="righter">
			  <div class="widget widget-map">
                <div class="widget-head"><span class="title"><b>Audit Locations</b></span>
		      <label style="margin-left:5%;">Audit Round</label>
                      <select class="" id="auditRndNoLocations" multiple="multiple" onchange="getAuditLocationDetails()">
                          <?php
			  foreach($spiV3auditRoundNo as $auditRoundNo)
			  {
			    ?>
			    <option value="<?php echo $auditRoundNo['auditroundno'];?>"> <?php echo $auditRoundNo['auditroundno']." (".$auditRoundNo['rowCount'].")";?></option>
			    <?php
			  }
			  ?>
                        </select>
		      </div>
                <div class="map-container" id="auditLocations" onclick="getdata();">
                  
                </div>
              </div>
            </div>

          </div>
		  

        </div>
      </div>
<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhZa4hDifE6p2sbaxJehS7gcrZOJScIqM&libraries=drawing,geometry,places">
</script>

<script src="<?php echo $this->basePath('assets/js/maplace.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo $this->basePath('assets/lib/select2/js/select2.min.js'); ?>" type="text/javascript"></script>


<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>

    <script type="text/javascript">
      
      var color1 = "red";
      var color2 = "orange";
      var color3 = "yellow";
      var color4 = "#8DD63E";
      var color5 = "#528A16";

  //Get the template css colors into js vars
  function getColor( c ){
    var tmp = $("<div>", { class: c }).appendTo("body");
    var color = tmp.css("background-color");
    tmp.remove();

    return color;
  }
  
		var colors = {};
		colors.primary = getColor('clr-primary');
        colors.success = getColor('clr-success');
        colors.info    = getColor('clr-info');
        colors.warning = getColor('clr-warning');
        colors.danger  = getColor('clr-danger');
        colors.alt1    = getColor('clr-alt1');
        colors.alt2    = getColor('clr-alt2');
        colors.alt3    = getColor('clr-alt3');
        colors.alt4    = getColor('clr-alt4');
      
function widget_top_1(){


		<?php
		
			$perf1[0]['level0'] = ($perf1[0]['level0'] > 0) ? $perf1[0]['level0'] : 0;
			$perf1[0]['level1'] = ($perf1[0]['level1'] > 0) ? $perf1[0]['level1'] : 0;
			$perf1[0]['level2'] = ($perf1[0]['level2'] > 0) ? $perf1[0]['level2'] : 0;
			$perf1[0]['level3'] = ($perf1[0]['level3'] > 0) ? $perf1[0]['level3'] : 0;
			$perf1[0]['level4'] = ($perf1[0]['level4'] > 0) ? $perf1[0]['level4'] : 0;
			
			$level0Color="";
			if($perf1[0]['level0']<40){
			  $level0Color='red';
			}else if($perf1[0]['level0']>=40 && $perf1[0]['level0']<=59){
			  $level0Color='orange';
			}
			else if($perf1[0]['level0']>=60 && $perf1[0]['level0']<=79){
			  $level0Color='yellow';
			}else if($perf1[0]['level0']>=80 && $perf1[0]['level0']<=89){
			  $level0Color='#8DD63E';
			}else if($perf1[0]['level0']>=90){
			  $level0Color='#528A16';
			}
			//level1
			if($perf1[0]['level1']<40){
			  $level1Color='red';
			}else if($perf1[0]['level1']>=40 && $perf1[0]['level1']<=59){
			  $level1Color='orange';
			}
			else if($perf1[0]['level1']>=60 && $perf1[0]['level1']<=79){
			  $level1Color='yellow';
			}else if($perf1[0]['level1']>=80 && $perf1[0]['level1']<=89){
			  $level1Color='#8DD63E';
			}else if($perf1[0]['level1']>=90){
			  $level1Color='#528A16';
			}
			//level2
			if($perf1[0]['level2']<40){
			  $level2Color='red';
			}else if($perf1[0]['level2']>=40 && $perf1[0]['level2']<=59){
			  $level2Color='orange';
			}
			else if($perf1[0]['level2']>=60 && $perf1[0]['level2']<=79){
			  $level2Color='yellow';
			}else if($perf1[0]['level2']>=80 && $perf1[0]['level2']<=89){
			  $level2Color='#8DD63E';
			}else if($perf1[0]['level2']>=90){
			  $level2Color='#528A16';
			}
			//level3
			if($perf1[0]['level3']<40){
			  $level3Color='red';
			}else if($perf1[0]['level3']>=40 && $perf1[0]['level3']<=59){
			  $level3Color='orange';
			}
			else if($perf1[0]['level3']>=60 && $perf1[0]['level3']<=79){
			  $level3Color='yellow';
			}else if($perf1[0]['level3']>=80 && $perf1[0]['level3']<=89){
			  $level3Color='#8DD63E';
			}else if($perf1[0]['level3']>=90){
			  $level3Color='#528A16';
			}
			//level4
			if($perf1[0]['level4']<40){
			  $level4Color='red';
			}else if($perf1[0]['level4']>=40 && $perf1[0]['level4']<=59){
			  $level4Color='orange';
			}
			else if($perf1[0]['level4']>=60 && $perf1[0]['level4']<=79){
			  $level4Color='yellow';
			}else if($perf1[0]['level4']>=80 && $perf1[0]['level4']<=89){
			  $level4Color='#8DD63E';
			}else if($perf1[0]['level4']>=90){
			  $level4Color='#528A16';
			}
	  	?>	  		    
			
	  var data = [
		{
		  value: <?php echo $perf1[0]['level0']; ?>,
		  color: '<?php echo $level0Color; ?>',
		  label: "Level 0 (Below 40)"
		},
		 {
		  value: <?php echo $perf1[0]['level1']; ?>,
		  color: '<?php echo $level1Color; ?>',
		  label: "Level 1 (40-59)"
		},
		 {
		  value: <?php echo $perf1[0]['level2']; ?>,
		  color: '<?php echo $level2Color; ?>',
		  label: "Level 2 (60-79)"
		},
		 {
		  value: <?php echo $perf1[0]['level3']; ?>,
		  color: '<?php echo $level3Color; ?>',
		  label: "Level 3 (80-89)"
		},
		{
		  value: <?php echo $perf1[0]['level4']; ?>,
		  color: '<?php echo $level4Color; ?>',
		  label: "Level 4 (90 and above)"
		},
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		  animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  tooltipTemplate: "<%= value %>",
		  legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'

	  }
	  
	  var ctx = document.getElementById("widget-top-1").getContext("2d");
	  
	  var myChart = new Chart(ctx).Pie(data, options);
	  
	  document.getElementById('legendOverall').innerHTML = myChart.generateLegend();	  
	  
        
        
    }
    
    function widget_top_2(){
		<?php
		
			$perflast30[0]['level0'] = ($perflast30[0]['level0'] > 0) ? $perflast30[0]['level0'] : 0;
			$perflast30[0]['level1'] = ($perflast30[0]['level1'] > 0) ? $perflast30[0]['level1'] : 0;
			$perflast30[0]['level2'] = ($perflast30[0]['level2'] > 0) ? $perflast30[0]['level2'] : 0;
			$perflast30[0]['level3'] = ($perflast30[0]['level3'] > 0) ? $perflast30[0]['level3'] : 0;
			$perflast30[0]['level4'] = ($perflast30[0]['level4'] > 0) ? $perflast30[0]['level4'] : 0;
			
			$perflast30Color0="";
			if($perflast30[0]['level0']<40){
			  $perflast30Color0='red';
			}else if($perflast30[0]['level0']>=40 && $perflast30[0]['level0']<=59){
			  $perflast30Color0='orange';
			}
			else if($perflast30[0]['level0']>=60 && $perflast30[0]['level0']<=79){
			  $perflast30Color0='yellow';
			}else if($perflast30[0]['level0']>=80 && $perflast30[0]['level0']<=89){
			  $perflast30Color0='#8DD63E';
			}else if($perflast30[0]['level0']>=90){
			  $perflast30Color0='#528A16';
			}
			//level1
			if($perflast30[0]['level1']<40){
			  $perflast30Color1='red';
			}else if($perflast30[0]['level1']>=40 && $perflast30[0]['level1']<=59){
			  $perflast30Color1='orange';
			}
			else if($perflast30[0]['level1']>=60 && $perflast30[0]['level1']<=79){
			  $perflast30Color1='yellow';
			}else if($perflast30[0]['level1']>=80 && $perflast30[0]['level1']<=89){
			  $perflast30Color1='#8DD63E';
			}else if($perflast30[0]['level1']>=90){
			  $perflast30Color1='#528A16';
			}
			//level2
			if($perflast30[0]['level2']<40){
			  $perflast30Color2='red';
			}else if($perflast30[0]['level2']>=40 && $perflast30[0]['level2']<=59){
			  $perflast30Color2='orange';
			}
			else if($perflast30[0]['level2']>=60 && $perflast30[0]['level2']<=79){
			  $perflast30Color2='yellow';
			}else if($perflast30[0]['level2']>=80 && $perflast30[0]['level2']<=89){
			  $perflast30Color2='#8DD63E';
			}else if($perflast30[0]['level2']>=90){
			  $perflast30Color2='#528A16';
			}
			//level3
			if($perflast30[0]['level3']<40){
			  $perflast30Color3='red';
			}else if($perflast30[0]['level3']>=40 && $perflast30[0]['level3']<=59){
			  $perflast30Color3='orange';
			}
			else if($perflast30[0]['level3']>=60 && $perflast30[0]['level3']<=79){
			  $perflast30Color3='yellow';
			}else if($perflast30[0]['level3']>=80 && $perflast30[0]['level3']<=89){
			  $perflast30Color3='#8DD63E';
			}else if($perflast30[0]['level3']>=90){
			  $perflast30Color3='#528A16';
			}
			//level4
			if($perflast30[0]['level4']<40){
			  $perflast30Color4='red';
			}else if($perflast30[0]['level4']>=40 && $perflast30[0]['level4']<=59){
			  $perflast30Color4='orange';
			}
			else if($perflast30[0]['level4']>=60 && $perflast30[0]['level4']<=79){
			  $perflast30Color4='yellow';
			}else if($perflast30[0]['level4']>=80 && $perflast30[0]['level4']<=89){
			  $perflast30Color4='#8DD63E';
			}else if($perflast30[0]['level4']>=90){
			  $perflast30Color4='#528A16';
			}
	  	?>
			
	  var data = [
		 {
		  value: <?php echo $perflast30[0]['level0']; ?>,
		  color: '<?php echo $perflast30Color0; ?>',
		  label: "Level 0 (Below 40)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level1']; ?>,
		  color: '<?php echo $perflast30Color1; ?>',
		  label: "Level 1 (40-59)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level2']; ?>,
		  color: '<?php echo $perflast30Color2; ?>',
		  label: "Level 2 (60-79)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level3']; ?>,
		  color: '<?php echo $perflast30Color3; ?>',
		  label: "Level 3 (80-89)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level4']; ?>,
		  color: '<?php echo $perflast30Color4; ?>',
		  label: "Level 4 (90 and above)"
	  },
	  
	  
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		      animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  percentageInnerCutout: 50,
		  tooltipTemplate: "<%= value %>",
		      legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'
	  }
	  
	  var ctx = document.getElementById("widget-top-2").getContext("2d");
	  
	  var myChart = new Chart(ctx).Doughnut(data, options);
	  
	  
	  document.getElementById('legend30').innerHTML = myChart.generateLegend();	  
	  
	  
    }
    
    function widget_top_3(){
			

		<?php
		
			$perflast180[0]['level0'] = ($perflast180[0]['level0'] > 0) ? $perflast180[0]['level0'] : 0;
			$perflast180[0]['level1'] = ($perflast180[0]['level1'] > 0) ? $perflast180[0]['level1'] : 0;
			$perflast180[0]['level2'] = ($perflast180[0]['level2'] > 0) ? $perflast180[0]['level2'] : 0;
			$perflast180[0]['level3'] = ($perflast180[0]['level3'] > 0) ? $perflast180[0]['level3'] : 0;
			$perflast180[0]['level4'] = ($perflast180[0]['level4'] > 0) ? $perflast180[0]['level4'] : 0;
			
			$perflast180Color0="";
			if($perflast180[0]['level0']<40){
			  $perflast180Color0='red';
			}else if($perflast180[0]['level0']>=40 && $perflast180[0]['level0']<=59){
			  $perflast180Color0='orange';
			}
			else if($perflast180[0]['level0']>=60 && $perflast180[0]['level0']<=79){
			  $perflast180Color0='yellow';
			}else if($perflast180[0]['level0']>=80 && $perflast180[0]['level0']<=89){
			  $perflast180Color0='#8DD63E';
			}else if($perflast180[0]['level0']>=90){
			  $perflast180Color0='#528A16';
			}
			//level1
			if($perflast180[0]['level1']<40){
			  $perflast180Color1='red';
			}else if($perflast180[0]['level1']>=40 && $perflast180[0]['level1']<=59){
			  $perflast180Color1='orange';
			}
			else if($perflast180[0]['level1']>=60 && $perflast180[0]['level1']<=79){
			  $perflast180Color1='yellow';
			}else if($perflast180[0]['level1']>=80 && $perflast180[0]['level1']<=89){
			  $perflast180Color1='#8DD63E';
			}else if($perflast180[0]['level1']>=90){
			  $perflast180Color1='#528A16';
			}
			//level2
			if($perflast180[0]['level2']<40){
			  $perflast180Color2='red';
			}else if($perflast180[0]['level2']>=40 && $perflast180[0]['level2']<=59){
			  $perflast180Color2='orange';
			}
			else if($perflast180[0]['level2']>=60 && $perflast180[0]['level2']<=79){
			  $perflast180Color2='yellow';
			}else if($perflast180[0]['level2']>=80 && $perflast180[0]['level2']<=89){
			  $perflast180Color2='#8DD63E';
			}else if($perflast180[0]['level2']>=90){
			  $perflast180Color2='#528A16';
			}
			//level3
			if($perflast180[0]['level3']<40){
			  $perflast180Color3='red';
			}else if($perflast180[0]['level3']>=40 && $perflast180[0]['level3']<=59){
			  $perflast180Color3='orange';
			}
			else if($perflast180[0]['level3']>=60 && $perflast180[0]['level3']<=79){
			  $perflast180Color3='yellow';
			}else if($perflast180[0]['level3']>=80 && $perflast180[0]['level3']<=89){
			  $perflast180Color3='#8DD63E';
			}else if($perflast180[0]['level3']>=90){
			  $perflast180Color3='#528A16';
			}
			//level4
			if($perflast180[0]['level4']<40){
			  $perflast180Color4='red';
			}else if($perflast180[0]['level4']>=40 && $perflast180[0]['level4']<=59){
			  $perflast180Color4='orange';
			}
			else if($perflast180[0]['level4']>=60 && $perflast180[0]['level4']<=79){
			  $perflast180Color4='yellow';
			}else if($perflast180[0]['level4']>=80 && $perflast180[0]['level4']<=89){
			  $perflast180Color4='#8DD63E';
			}else if($perflast180[0]['level4']>=90){
			  $perflast180Color4='#528A16';
			}
	  	?>	  		
			
	  var data = [
		 {
		  value: <?php echo $perflast180[0]['level0']; ?>,
		  color: '<?php echo $perflast180Color0; ?>',
		  label: "Level 0 (Below 40)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level1']; ?>,
		  color: '<?php echo $perflast180Color1; ?>',
		  label: "Level 1 (40-59)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level2']; ?>,
		  color: '<?php echo $perflast180Color2; ?>',
		  label: "Level 2 (60-79)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level3']; ?>,
		  color: '<?php echo $perflast180Color3; ?>',
		  label: "Level 3 (80-89)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level4']; ?>,
		  color: '<?php echo $perflast180Color4; ?>',
		  label: "Level 4 (90 and above)"
	  },
	  
	  
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		      animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  percentageInnerCutout: 50,
		  tooltipTemplate: "<%= value %>",
		      legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'

	  }
	  
	  var ctx = document.getElementById("widget-top-3").getContext("2d");
	  
	  var myChart = new Chart(ctx).Doughnut(data, options);
	  
	  
	  document.getElementById('legend180').innerHTML = myChart.generateLegend();	  
	  
	  
    }
	
    function bar_chart(){
	
<?php


					  $counter = 0;
					  $barData = array();
					  $labNameData = array();
					  foreach($allSubmissions as $row) {
						if($counter == 30) break;
						
						if($row['AUDIT_SCORE_PERCANTAGE'] < 40){
						  $color = '#FF0000';
						}else if($row['AUDIT_SCORE_PERCANTAGE'] >= 40 && $row['AUDIT_SCORE_PERCANTAGE'] <60){
						  $color = '#FFA500';
						}else if($row['AUDIT_SCORE_PERCANTAGE'] >= 60 && $row['AUDIT_SCORE_PERCANTAGE'] <80){
						  $color = '#FFFF00';
						}else if($row['AUDIT_SCORE_PERCANTAGE'] >= 80 && $row['AUDIT_SCORE_PERCANTAGE'] <90){
						  $color = '#8DD63E';
						}else if($row['AUDIT_SCORE_PERCANTAGE'] >= 90){
						  $color = '#528A16';
						}
						
						$barData[] = "{ y : ".round($row['AUDIT_SCORE_PERCANTAGE'],2). ", color : '".$color."' }"; 
						$labNameData[] = ("'Date : ".$this->humanDateFormat($row['assesmentofaudit'])."<br>' + ' ' + 'Facility Name : ".addslashes($row['facilityname'])." <br> Testing Point Name : ".addslashes($row['testingpointname'])."<br>'"); 
						$counter++;
					  }
					?>		
	
$('#audit-points-barchart').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        xAxis: {
            categories: [<?php echo implode(",",$labNameData); ?>],
            crosshair: true,
			labels:
			{
			  enabled: false
			}
        },
		 legend: {
            enabled: false
        },
        yAxis: {
            min: 0,
			max : 100,
            title: {
                text: 'Audit Score in %'
            }
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="padding:0;font-size:10px">{series.name}: </td>' +
                '<td style="padding:0;font-size:10px">{point.y:.1f}</td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0
            }
        },
        series: [{
            name: 'Audit Score Percentage',
            data: [<?php echo implode(",",$barData); ?>]
        }]
    });	
	
    }
    

function getAuditWorstDetails()
  {
    value = $("#auditRndWorstNo").val();
    limitBar = $("#limitBar").val();
      $.post("<?php echo $this->url('spi-v3-form', array('action' => 'worst-performance')); ?>", {roundno:value,limitBar:limitBar},
      function (data) {
	  $("#zeroCountChart").html(data);
      });
      
  }
  function getAuditDetails()
  {
    value = $("#auditRndNo").val();
      $.post("<?php echo $this->url('spi-v3-form', array('action' => 'audit-performance')); ?>", {roundno:value},
      function (data) {
	  $("#radarChart").html(data);
      });
      
  }
  function getAuditLocationDetails()
  {
    value = $("#auditRndNoLocations").val();
      $.post("<?php echo $this->url('spi-v3-form', array('action' => 'audit-locations')); ?>", {roundno:value},
      function (data) {
	  $("#auditLocations").html(data);
      });
  }

//Calendar Widget
    function calendar_widget(){
    	var widget = $(".widget-calendar");
    	var calNotes = $(".cal-notes", widget);
    	var calNotesDay = $(".day", calNotes);
    	var calNotesDate = $(".date", calNotes);

    	//Calculate the weekday name
    	var d = new Date();
		var weekday = new Array(7);
		weekday[0]=  "Sunday";
		weekday[1] = "Monday";
		weekday[2] = "Tuesday";
		weekday[3] = "Wednesday";
		weekday[4] = "Thursday";
		weekday[5] = "Friday";
		weekday[6] = "Saturday";

		var weekdayName = weekday[d.getDay()];

		calNotesDay.html( weekdayName );

		//Calculate the month name
		var month = new Array();
		month[0] = "January";
		month[1] = "February";
		month[2] = "March";
		month[3] = "April";
		month[4] = "May";
		month[5] = "June";
		month[6] = "July";
		month[7] = "August";
		month[8] = "September";
		month[9] = "October";
		month[10] = "November";
		month[11] = "December";

		var monthName = month[d.getMonth()];
		var monthDay = d.getDate();

		calNotesDate.html( monthName + " " + monthDay);

      if (typeof jQuery.ui != 'undefined') {
		
		
		<?php
		
		$eventDatesArray = array();
		$eventCount = array();
		foreach($allSubmissions as $row) {
		  $humanDate = $this->humanDateFormat($row['assesmentofaudit']);
		  $eventDatesArray[] = "'".$humanDate."'";
		  if(isset($eventCount[$humanDate])){
			$eventCount[$humanDate] = $eventCount[$humanDate] + 1;
		  }else{
			$eventCount[$humanDate] = 1;
		  }
		}
		
		$countJson = json_encode($eventCount);

		if($countJson != null && $countJson != ""){
		?>
		  var countJson = <?php echo $countJson; ?>
		<?php
		}else{
		?>
		  var countJson = null;  
		<?php
		}
		?>
		
		
		var eventDates = [<?php echo implode(",",$eventDatesArray); ?>];
		
		
		
        $( ".ui-datepicker" ).datepicker({
			dateFormat: 'dd-M-yy',
        	onSelect: function(s, o){
        		var sd = new Date(s);
        		var weekdayName = weekday[sd.getDay()];
        		var monthName = month[sd.getMonth()];
				var monthDay = sd.getDate();
				calNotesDay.html( weekdayName );
				calNotesDate.html( monthName + " " + monthDay);
        	},
			beforeShowDay: function(date) {
			  hdate = $.datepicker.formatDate('dd-M-yy', date );
			  if($.inArray(hdate, eventDates) > -1){
				  return [true,"event","Audits on this date : " + countJson[hdate]];
			  }
			  else{
				  return [true,'',"No recorded audits on this date"];
			  }
			}
        });
      }
    }
    function getdata()
    {
    var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,"n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}
    
     value = $("#auditRndNoLocations").val();
     if(value!=null){
      var encodedString = Base64.encode("'"+value+"'");
     window.open('/common/audit-locations?id='+encodedString, '_blank'); 
     }else{
     window.open('/common/audit-locations', '_blank');
     }
    }
      $(document).ready(function(){
      	//initialize the javascript
		
		
    $(".select2").select2({
      width: '100%',
	  placeholder: '',
	  allowClear: true,
	  tags : false
    });		
        widget_top_1();
        widget_top_2();
        widget_top_3();
        //radar_chart();
	getAuditDetails();
        calendar_widget();
		bar_chart();
		//zeroCountsBarChart();
		getAuditWorstDetails();
		
		getAuditLocationDetails();
	//	new Maplace({
	//	  locations: LocsA,
	//	  map_div: '#gmap',
	//      controls_on_map: true,
	//	  map_options : {
	//		  mapTypeId: google.maps.MapTypeId.ROADMAP,
	//		  zoom: 8,
	//		   scrollwheel: false
	//	  }
	//	}).Load();
		
		
	  $("#auditRndNo").multipleSelect({placeholder:'Please select audit round no.',width: '40%',minimumCountSelected:'2'});
	  $("#auditRndWorstNo").multipleSelect({placeholder:'Please select audit round no.',width: '31%',minimumCountSelected:'2'});
	  $("#auditRndNoLocations").multipleSelect({placeholder:'Please select audit round no.',width: '40%',minimumCountSelected:'2'});
      });
    </script>