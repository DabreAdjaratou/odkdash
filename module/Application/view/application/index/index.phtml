<link rel="stylesheet" type="text/css" href="<?php echo $this->basePath('assets/lib/select2/css/select2.min.css'); ?>"/>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.11/css/dataTables.bootstrap.min.css"/>
<link rel="stylesheet" href="<?php echo $this->basePath('assets/css/jquery.multiselect.css'); ?>" type="text/css"/>
<script src="<?php echo $this->basePath('assets/js/jquery.multiselect.js'); ?>" type="text/javascript"></script>
<link rel="stylesheet" href="<?php echo $this->basePath('assets/css/daterangepicker-bs3.css'); ?>" type="text/css"/>
<style>
  .auditPointName{
	color:#fff;
	margin:0;
	
	min-width: 200px;
	vertical-align:top;
  }
  
  .auditPointName:hover{
	white-space: normal !important;
	overflow: visible;
	text-overflow: '';
  }
  
  .event a {
    background-color: #8eaffe !important;
    background-image :none !important;
    color: #ffffff !important;
	border-radius:50%;
}


.highcharts-tooltip span {
    width:250px;
    overflow:auto;
    white-space:normal !important;
}

.select2{
  width:200px !important;
}

.title h3{
  display:inline;
}

/*multiselect*/
/*.ui-state-hover, .ui-widget-content .ui-state-hover{color: #1c94c4;border: 1px solid #cccccc;background:none;}
.ui-state-active{color: #1c94c4;border: 1px solid #cccccc;background:none;}
.ui-multiselect-header{display: none;}
*/
.widget-calendar .cal-container .cal-calendar .ui-datepicker table.ui-datepicker-calendar tr td a.ui-state-highlight{
  background: none !important;
  color: #888;
  border:none;
}
.limitBar{width: 10%;color: #555;background-color: #fff;background-image: none;border: 1px solid #ccc;border-radius: 4px;padding: 1px;vertical-align: middle;}
  
  
 
    .highcharts-legend{display: block !important;}
 
</style>
<link rel="stylesheet" href="<?php echo $this->basePath('assets/css/jquery.multiselect.css'); ?>" type="text/css"/>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
<script src="<?php echo $this->basePath('assets/js/jquery.multiselect.js'); ?>" type="text/javascript"></script>
      <div class="am-content">
		<div class="page-head">
          <h2>SPI-RT 3.0 Checklist</h2>
        </div>
        <div class="main-content">
        
          <!--+general-chart("classes", "title", "height", "id", "counter value", "counter desc", tools enabled (use true or false))-->
          <div class="row">
            <div class="col-md-4">
              <div class="widget widget-pie">
                <div class="widget-head"><span class="title">SPI RT v3 Overall</span></div>
                <div class="row chart-container">
                  <div class="col-md-6">
		    <canvas id="widget-top-1" style="width: 100%; height: 170px;;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legendOverall"></div>
                  </div>
                </div>
				<div class="row chart-info">
                  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perf1[0]['oldestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;padding-left:5px;;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perf1[0]['newestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perf1[0]['totalDataPoints']; ?></span></div>
                </div>				
              </div>
            </div>
            <div class="col-md-4">
              <div class="widget widget-pie widget-pie-stats">
                <div class="widget-head"><span class="title">SPI RT v3 Last 180 days</span></div>
                <div class="row chart-container">
                  <div class="col-md-6">
		    <canvas id="widget-top-3" style="width: 100%; height: 170px;;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legend180"></div>
                  </div>
                </div>
		<div class="row chart-info">
                  <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perflast180[0]['oldestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;padding-left:5px;;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perflast180[0]['newestDate']) ?></span></div>
                  <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perflast180[0]['totalDataPoints']; ?></span></div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="widget widget-pie">
                <div class="widget-head"><span class="title">
		SPI RT v3 &nbsp;
		<input style="width:62%;" type="text" placeholder="Enter Date" class="datepicker limitBar" id="spiRTv3">
		  <a style="" href="javascript:void(0)" class="btn btn-sm btn-primary" onclick="getspiRTv3()">OK</a>
		</span></div>
		
		
		<div id="dateRangePickerValue">
                <div class="row chart-container">
                  <div class="col-md-6">
		    <canvas id="widget-top-2" style="width: 100%; height: 170px;"></canvas>
                  </div>
                  <div class="col-md-6">
                    <div class="legend" id="legend30"></div>
                  </div>
                </div>
		  <div class="row chart-info">
		    <div class="col-xs-4" style="text-align:center;"><span class="title">From Date</span><span class="number"><?php echo $this->humanDateFormat($perflast30[0]['oldestDate']) ?></span></div>
		    <div class="col-xs-4" style="text-align:center;padding-left:5px;"><span class="title">To Date</span><span class="number"><?php echo $this->humanDateFormat($perflast30[0]['newestDate']) ?></span></div>
		    <div class="col-xs-4" style="text-align:center;"><span class="title">No. of Audits</span><span class="number"><?php echo $perflast30[0]['totalDataPoints']; ?></span></div>
                </div>
		</div>
              </div>
            </div>			
          </div>
		  <div class="row">
			
			
			<div class="col-md-6">
			  <div class="widget">
				<div class="widget-head">
				  <span class="title"><h3>Testing Volume</h3>
				    <input style="width:55%;margin-left:1%" type="text" placeholder="Enter Date" class="datepicker limitBar" id="testingVolumeDate">
				    <a style="" href="javascript:void(0)" class="btn btn-sm btn-primary" onclick="getTestingVolumeValue()">OK</a>
				  </span>
				</div>
				<div class="chart-container" id="testVolumeValues">
				  <div style="width:100%;height:340px" id="volumeChart"></div>
				</div>
			  </div>			  
			</div>			
			
			
			<div class="col-md-6">
			  <div class="widget">
				<div class="widget-head">
				  <span class="title"><h3>Last 20 Audits</h3></span>
				</div>
				<div class="chart-container">
				  <div id="audit-points-barchart"  style="width:100%;height:340px"></div>
				</div>
			  </div>
			</div>

		  </div>
          <div class="row">
			
			<div class="col-md-6" id="lefter">
                  <div class="widget widget-radar widget-pie">
                    <div class="widget-head">
                      <span class="title"><h3>Audit Performance</h3></span>
					  <label style="margin-left:5%;">Audit Round</label>
                      <select class="" id="auditRndNo" multiple="multiple" onchange="getAuditDetails()">
						<?php
						  foreach($spiV3auditRoundNo as $auditRoundNo)
						  {
							?>
							<option value="<?php echo $auditRoundNo['auditroundno'];?>"> <?php echo $auditRoundNo['auditroundno']." (".$auditRoundNo['rowCount'].")";?></option>
							<?php
						  }
						  ?>
                        </select>
                    </div>
					<div id="radarChart"></div>
				  </div>
				  <div class="widget widget-radar widget-pie">
                    <div class="widget-head">
                      <span class="title"><h3>Worst Performing Questions</h3>
			    <label style="margin-left:2%;">Rounds</label>
				  <select class="" id="auditRndWorstNo" multiple="multiple" onchange="getAuditWorstDetails()">
					<?php
					  foreach($spiV3auditRoundNo as $auditRoundNo)
					  {
						?>
						<option value="<?php echo $auditRoundNo['auditroundno'];?>"> <?php echo $auditRoundNo['auditroundno']." (".$auditRoundNo['rowCount'].")";?></option>
						<?php
					  }
					  ?>
					</select>
		      </span>
		      
					  <div style="margin-top:2%;">
						<label style="margin-left: 1%;">Limit</label>
			    <select class="limitBar" style="" id="limitBar" onchange="getAuditWorstDetails()">
				  <option value="5">5</option>
				  <option value="10" selected="selected">10</option>
				  <option value="15">15</option>
				  <option value="20">20</option>
				  <option value="30">30</option>
			    </select>
								
							  <label style="margin-left: 1%;">Testing Volume</label>
							  <input style="width:38%" type="text" placeholder="Enter Date" class="limitBar datepicker" id="worstDate">
							  <a style="" href="javascript:void(0)" class="btn btn-sm btn-primary" onclick="getAuditWorstDetails()">OK</a>
							  </div>
					  </div>
					  <div style="margin-top:2%">
					  
					</div>
                    <div class="chart-container" id="zeroCountChart" style="height:420px;"></div>
                  </div>
				  
			</div>			
			
            <div class="col-md-6" id="righter">
			  <div class="widget widget-map">
                <div class="widget-head"><span class="title"><h3>Audit Locations</h3></span>
		      <label style="margin-left:5%;">Audit Round</label>
                      <select class="" id="auditRndNoLocations" multiple="multiple" onchange="getAuditLocationDetails()">
                          <?php
			  foreach($spiV3auditRoundNo as $auditRoundNo)
			  {
			    ?>
			    <option value="<?php echo $auditRoundNo['auditroundno'];?>"> <?php echo $auditRoundNo['auditroundno']." (".$auditRoundNo['rowCount'].")";?></option>
			    <?php
			  }
			  ?>
                        </select>
		      </div>
                <div class="map-container" id="auditLocations" style="max-height:1150px;">
                  
                </div>
              </div>
            </div>

          </div>
		  
		  <div class="row">
			
			
			<div class="col-md-12 col-sm-12">
			  <div class="widget">
				<div class="widget-head">
				  <span class="title"><h3>Audit Dates</h3></span>
				</div>
				<div class="chart-container">
				  <div style="width:100%;height:340px" id="auditDates"></div>
				</div>
			  </div>			  
			</div>			
			
			

		  </div>
		  
		  
		  <div class="row">
			<div class="col-md-12 col-sm-12">
			                   <div class="widget widget-radar widget-pie">
                    <div class="widget-head">
                      <span class="title"><h3>Latest Audits</h3></span> 
					<br>
                    <table class="datatables table table-striped table-bordered">
					<thead>
					  <tr>
						  <td>Facility ID</td>
						  <td>Facility name</td>
						  <td>Testing Point Name</td>
						  <td>Testing Point Type</td>
						  <td>Status</td>
						  <td>Actions</td>
						</tr>
					</thead>
					<tbody>
					  <?php
					  $count = 0;
					  
					  $loginContainer = new \Zend\Session\Container('credo');
					  $role = $loginContainer->roleCode;
					  $acl = (isset($loginContainer->acl) && $loginContainer->acl != "") ? unserialize($loginContainer->acl) : null;
					  if ($acl != null && $acl->isAllowed($role, 'Application\Controller\SpiV3', 'edit')) {
						  $update = true;
					  } else {
						  $update = false;
					  }					  
					  foreach($rawSubmissions as $row) {
						
						if($count == 25) break;
						
					  ?>					  
						<tr>
						  <td><?php echo $row['facilityid']; ?></td>
						  <td><?php echo $row['facilityname']; ?></td>
						  <td><?php echo $row['testingpointname']; ?></td>
						  <td><?php echo $row['testingpointtype']; ?></td>
						  <td><?php echo ucfirst($row['status']); ?></td>
						  <td>
						      <?php if($update) { ?> <a href="/spi-v3/edit/<?php echo $row['id']; ?>" style="white-space:nowrap;"><i class="fa fa-pencil"></i> Edit</a>&nbsp;&nbsp;<?php } ?>
						      <?php if($row['status'] == 'approved') { ?> <a href="/email/index/<?php echo base64_encode($row['id']); ?>"><i class="fa fa-envelope"></i> Send Mail</a><?php } ?>
						  </td>
						</tr>
                      <?php
						$count++;
					  }
					  ?>
					  </tbody>
                    </table>
                  

			</div>
		  </div>

			</div>
		  </div>

        </div>
      </div>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDhZa4hDifE6p2sbaxJehS7gcrZOJScIqM&libraries=drawing,geometry,places"></script>

<script src="<?php echo $this->basePath('assets/js/maplace.min.js'); ?>" type="text/javascript"></script>
<script src="<?php echo $this->basePath('assets/lib/select2/js/select2.min.js'); ?>" type="text/javascript"></script>


<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://highcharts.github.io/pattern-fill/pattern-fill.js"></script>

<script type="text/javascript" src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.11/js/dataTables.bootstrap.min.js"></script>
<script src="<?php echo $this->basePath('assets/js/daterangepicker.js'); ?>" type="text/javascript"></script>

    <script type="text/javascript">
      
		var color1 = "red";
		var color2 = "orange";
		var color3 = "yellow";
		var color4 = "#8DD63E";
		var color5 = "#528A16";

		//Get the template css colors into js vars
		function getColor( c ){
		  var tmp = $("<div>", { class: c }).appendTo("body");
		  var color = tmp.css("background-color");
		  tmp.remove();
	  
		  return color;
		}
  
		var colors = {};
		colors.primary = getColor('clr-primary');
        colors.success = getColor('clr-success');
        colors.info    = getColor('clr-info');
        colors.warning = getColor('clr-warning');
        colors.danger  = getColor('clr-danger');
        colors.alt1    = getColor('clr-alt1');
        colors.alt2    = getColor('clr-alt2');
        colors.alt3    = getColor('clr-alt3');
        colors.alt4    = getColor('clr-alt4');
      
		function widget_top_1(){


		<?php
		
			$perf1[0]['level0'] = ($perf1[0]['level0'] > 0) ? $perf1[0]['level0'] : 0;
			$perf1[0]['level1'] = ($perf1[0]['level1'] > 0) ? $perf1[0]['level1'] : 0;
			$perf1[0]['level2'] = ($perf1[0]['level2'] > 0) ? $perf1[0]['level2'] : 0;
			$perf1[0]['level3'] = ($perf1[0]['level3'] > 0) ? $perf1[0]['level3'] : 0;
			$perf1[0]['level4'] = ($perf1[0]['level4'] > 0) ? $perf1[0]['level4'] : 0;
			
	  	?>	  		    
			
	  var data = [
		{
		  value: <?php echo $perf1[0]['level0']; ?>,
		  color: color1,
		  label: "Level 0 (Below 40)"
		},
		 {
		  value: <?php echo $perf1[0]['level1']; ?>,
		  color: color2,
		  label: "Level 1 (40-59)"
		},
		 {
		  value: <?php echo $perf1[0]['level2']; ?>,
		  color: color3,
		  label: "Level 2 (60-79)"
		},
		 {
		  value: <?php echo $perf1[0]['level3']; ?>,
		  color: color4,
		  label: "Level 3 (80-89)"
		},
		{
		  value: <?php echo $perf1[0]['level4']; ?>,
		  color: color5,
		  label: "Level 4 (90 and above)"
		},
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		  animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  tooltipTemplate: "<%= value %>",
		  legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'

	  }
	  
	  var ctx = document.getElementById("widget-top-1").getContext("2d");
	  
	  var myChart = new Chart(ctx).Pie(data, options);
	  
	  document.getElementById('legendOverall').innerHTML = myChart.generateLegend();	  
	 
    }
    
    function widget_top_2(){
		<?php
		
			$perflast30[0]['level0'] = ($perflast30[0]['level0'] > 0) ? $perflast30[0]['level0'] : 0;
			$perflast30[0]['level1'] = ($perflast30[0]['level1'] > 0) ? $perflast30[0]['level1'] : 0;
			$perflast30[0]['level2'] = ($perflast30[0]['level2'] > 0) ? $perflast30[0]['level2'] : 0;
			$perflast30[0]['level3'] = ($perflast30[0]['level3'] > 0) ? $perflast30[0]['level3'] : 0;
			$perflast30[0]['level4'] = ($perflast30[0]['level4'] > 0) ? $perflast30[0]['level4'] : 0;
			
	  	?>
			
	  var data = [
		 {
		  value: <?php echo $perflast30[0]['level0']; ?>,
		  color: color1,
		  label: "Level 0 (Below 40)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level1']; ?>,
		  color: color2,
		  label: "Level 1 (40-59)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level2']; ?>,
		  color: color3,
		  label: "Level 2 (60-79)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level3']; ?>,
		  color: color4,
		  label: "Level 3 (80-89)"
	  },
		 {
		  value: <?php echo $perflast30[0]['level4']; ?>,
		  color: color5,
		  label: "Level 4 (90 and above)"
	  },
	  
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		  animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  percentageInnerCutout: 50,
		  tooltipTemplate: "<%= value %>",
		  legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'
	  }
	  
	  var ctx = document.getElementById("widget-top-2").getContext("2d");
	  
	  var myChart = new Chart(ctx).Doughnut(data, options);
	  
	  
	  document.getElementById('legend30').innerHTML = myChart.generateLegend();	  
	  
	  
    }
    
    function widget_top_3(){
			

		<?php
		
			$perflast180[0]['level0'] = ($perflast180[0]['level0'] > 0) ? $perflast180[0]['level0'] : 0;
			$perflast180[0]['level1'] = ($perflast180[0]['level1'] > 0) ? $perflast180[0]['level1'] : 0;
			$perflast180[0]['level2'] = ($perflast180[0]['level2'] > 0) ? $perflast180[0]['level2'] : 0;
			$perflast180[0]['level3'] = ($perflast180[0]['level3'] > 0) ? $perflast180[0]['level3'] : 0;
			$perflast180[0]['level4'] = ($perflast180[0]['level4'] > 0) ? $perflast180[0]['level4'] : 0;
			
	  	?>	  		
			
	  var data = [
		 {
		  value: <?php echo $perflast180[0]['level0']; ?>,
		  color: color1,
		  label: "Level 0 (Below 40)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level1']; ?>,
		  color: color2,
		  label: "Level 1 (40-59)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level2']; ?>,
		  color: color3,
		  label: "Level 2 (60-79)"
	  },
		 {
		  value: <?php echo $perflast180[0]['level3']; ?>,
		  color: color4,
		  label: "Level 3 (80-89)"
	  },
	  {
		  value: <?php echo $perflast180[0]['level4']; ?>,
		  color: color5,
		  label: "Level 4 (90 and above)"
	  }
	  
	  
	  
	  ];
	  
	  var options = {
		  segmentShowStroke: false,
		  animationSteps : 20,
		  animateRotate: true,
		  animateScale: false,
		  percentageInnerCutout: 50,
		  tooltipTemplate: "<%= value %>",
		  legendTemplate : '<table style="font-size:smaller;color:#545454"><tbody><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,0,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 0 (Below 40)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,165,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 1 (40-59)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(255,255,0);overflow:hidden"></div></div></td><td class="legendLabel">Level 2 (60-79)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(141,214,62);overflow:hidden"></div></div></td><td class="legendLabel">Level 3 (80-89)</td></tr><tr><td class="legendColorBox"><div style="border:1px solid #ccc;padding:1px"><div style="width:4px;height:0;border:5px solid rgb(82,138,22);overflow:hidden"></div></div></td><td class="legendLabel">Level 4 (90 and above)</td></tr></tbody></table>'

	  }
	  
	  var ctx = document.getElementById("widget-top-3").getContext("2d");
	  
	  var myChart = new Chart(ctx).Doughnut(data, options);
	  
	  
	  document.getElementById('legend180').innerHTML = myChart.generateLegend();	  
	  
	  
    }
	
    function bar_chart(){
	
<?php

	$counter = 0;
	$barData = array();
	$volumeData = array();
	$labNameData = array();
	foreach($allSubmissions as $row) {
	  if($counter == 20) break;
	  if($row['AUDIT_SCORE_PERCANTAGE'] < 40){
		$color = '#FF0000';
	  }else if($row['AUDIT_SCORE_PERCANTAGE'] >= 40 && $row['AUDIT_SCORE_PERCANTAGE'] <60){
		$color = '#FFA500';
	  }else if($row['AUDIT_SCORE_PERCANTAGE'] >= 60 && $row['AUDIT_SCORE_PERCANTAGE'] <80){
		$color = '#FFFF00';
	  }else if($row['AUDIT_SCORE_PERCANTAGE'] >= 80 && $row['AUDIT_SCORE_PERCANTAGE'] <90){
		$color = '#8DD63E';
	  }else if($row['AUDIT_SCORE_PERCANTAGE'] >= 90){
		$color = '#528A16';
	  }
	  
	  $barData[] = "{ y : ".round($row['AUDIT_SCORE_PERCANTAGE'],2). ", color : '".$color."' }"; 
	  $volumeData[] = (isset($row['avgMonthTesting']) ? $row['avgMonthTesting'] : 0); 
	  $labNameData[] = ("'Date : ".$this->humanDateFormat($row['assesmentofaudit'])."<br>' + ' ' + 'Facility Name : ".addslashes($row['facilityname'])." <br> Testing Point Name : ".addslashes($row['testingpointname'])."<br>'"); 
	  $counter++;
	  
	  
	  
	}
?>
	
$('#audit-points-barchart').highcharts({
        chart: {
			zoomType: 'xy'
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        xAxis: {
            categories: [<?php echo implode(",",$labNameData); ?>],
            crosshair: true,
			labels:
			{
			  enabled: false
			}
        },
		  legend: {
            enabled: true
        },
        yAxis: [
		  
		  { // Primary yAxis
            labels: {
                format: '{value}%',
                style: {
                    color: Highcharts.getOptions().colors[1]
                }
            },
            title: {
                text: 'Audit score in %',
                style: {
                    color: Highcharts.getOptions().colors[1]
                }
            },
			min : 0,
			max : 100
        }, { // Secondary yAxis
            title: {
                text: 'Testing Volume',
                style: {
                    color: Highcharts.getOptions().colors[0]
                }
            },
            labels: {
                format: '{value}',
                style: {
                    color: Highcharts.getOptions().colors[0]
                }
            },
            opposite: true
        }
        ],
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="padding:0;font-size:10px">{series.name}: </td>' +
                '<td style="padding:0;font-size:10px">{point.y:.2f}</td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0,
                borderWidth: 0
            }
        },
        series: [{
					  name: 'Audit Score Percentage',
					  data: [<?php echo implode(",",$barData); ?>],
					  stack : 'score',
					  type : 'column',
					  tooltip: {
		                valueSuffix: ' %'
		              }
				  },{
					  name: 'Testing Volume',
					  type : 'column',
					  data: [<?php echo implode(",",$volumeData); ?>],
					  stack : 'volume',
					  color: {
							  pattern : "https://raw.githubusercontent.com/highslide-software/pattern-fill/master/graphics/pattern3.png",
							  width: 6,
							  height: 6
							 },
					  yAxis: 1,
					  tooltip: {
		                valueSuffix: ' Tests'
		              }
				  }]
    });	
	
    }
    
function getspiRTv3()
{
      dateRange = $("#spiRTv3").val();
      $.post("<?php echo $this->url('spi-v3-form', array('action' => 'spirtv3-datewise')); ?>", {dateRange:dateRange},
      function (data) {
	  $("#dateRangePickerValue").html(data);
      });
}
function getTestingVolumeValue()
{
      dateRange = $("#testingVolumeDate").val();
      $.post("<?php echo $this->url('spi-v3-form', array('action' => 'testing-volume-datewise')); ?>", {dateRange:dateRange},
      function (data) {
	  $("#testVolumeValues").html(data);
      });
}
function getAuditWorstDetails()
  {
    value = $("#auditRndWorstNo").val();
    limitBar = $("#limitBar").val();
    dateRange = $("#worstDate").val();
      $.post("<?php echo $this->url('spi-v3-form', array('action' => 'worst-performance')); ?>", {roundno:value,limitBar:limitBar,dateRange:dateRange},
      function (data) {
	  $("#zeroCountChart").html(data);
      });
      
  }
  function getAuditDetails()
  {
    value = $("#auditRndNo").val();
      $.post("<?php echo $this->url('spi-v3-form', array('action' => 'audit-performance')); ?>", {roundno:value},
      function (data) {
	  $("#radarChart").html(data);
      });
      
  }
  function getAuditLocationDetails()
  {
    value = $("#auditRndNoLocations").val();
      $.post("<?php echo $this->url('spi-v3-form', array('action' => 'audit-locations')); ?>", {roundno:value},
      function (data) {
	  $("#auditLocations").html(data);
      });
  }

//Calendar Widget
    function calendar_widget(){
    	var widget = $(".widget-calendar");
    	var calNotes = $(".cal-notes", widget);
    	var calNotesDay = $(".day", calNotes);
    	var calNotesDate = $(".date", calNotes);

    	//Calculate the weekday name
    	var d = new Date();
		var weekday = new Array(7);
		weekday[0]=  "Sunday";
		weekday[1] = "Monday";
		weekday[2] = "Tuesday";
		weekday[3] = "Wednesday";
		weekday[4] = "Thursday";
		weekday[5] = "Friday";
		weekday[6] = "Saturday";

		var weekdayName = weekday[d.getDay()];

		calNotesDay.html( weekdayName );

		//Calculate the month name
		var month = new Array();
		month[0] = "January";
		month[1] = "February";
		month[2] = "March";
		month[3] = "April";
		month[4] = "May";
		month[5] = "June";
		month[6] = "July";
		month[7] = "August";
		month[8] = "September";
		month[9] = "October";
		month[10] = "November";
		month[11] = "December";

		var monthName = month[d.getMonth()];
		var monthDay = d.getDate();

		calNotesDate.html( monthName + " " + monthDay);

      if (typeof jQuery.ui != 'undefined') {
		
		
		<?php
		
		$eventDatesArray = array();
		$eventCount = array();
		foreach($allSubmissions as $row) {
		  $humanDate = $this->humanDateFormat($row['assesmentofaudit']);
		  $eventDatesArray[] = "'".$humanDate."'";
		  if(isset($eventCount[$humanDate])){
			$eventCount[$humanDate] = $eventCount[$humanDate] + 1;
		  }else{
			$eventCount[$humanDate] = 1;
		  }
		}
		
		$countJson = json_encode($eventCount);

		if($countJson != null && $countJson != ""){
		?>
		  var countJson = <?php echo $countJson; ?>
		<?php
		}else{
		?>
		  var countJson = null;  
		<?php
		}
		?>
		
		
		var eventDates = [<?php echo implode(",",$eventDatesArray); ?>];
		
		
		
        $( ".ui-datepicker" ).datepicker({
			dateFormat: 'dd-M-yy',
        	onSelect: function(s, o){
        		var sd = new Date(s);
        		var weekdayName = weekday[sd.getDay()];
        		var monthName = month[sd.getMonth()];
				var monthDay = sd.getDate();
				calNotesDay.html( weekdayName );
				calNotesDate.html( monthName + " " + monthDay);
        	},
			beforeShowDay: function(date) {
			  hdate = $.datepicker.formatDate('dd-M-yy', date );
			  if($.inArray(hdate, eventDates) > -1){
				  return [true,"event","Audits on this date : " + countJson[hdate]];
			  }
			  else{
				  return [true,'',"No recorded audits on this date"];
			  }
			}
        });
      }
    }
    function getdata()
    {
    var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,"n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}
    
     value = $("#auditRndNoLocations").val();
     if(value!=null){
      var encodedString = Base64.encode("'"+value+"'");
     window.open('/common/audit-locations?id='+encodedString, '_blank'); 
     }else{
     window.open('/common/audit-locations', '_blank');
     }
    }
      $(document).ready(function(){
      	//initialize the javascript
		
		$(".datatables").DataTable( {
        "order": [[ 4, "desc" ]]
		});
    $(".select2").select2({
      width: '100%',
	  placeholder: '',
	  allowClear: true,
	  tags : false
    });		
        widget_top_1();
        widget_top_2();
        widget_top_3();
        //radar_chart();
		getAuditDetails();
        //calendar_widget();
		bar_chart();
		//zeroCountsBarChart();
		getAuditWorstDetails();
		
		getAuditLocationDetails();

		
		
	  $("#auditRndNo").multipleSelect({placeholder:'Select Audit round(s)',width: '31%',minimumCountSelected:'2'});
	  $("#auditRndWorstNo").multipleSelect({placeholder:'Audit round(s)',width: '25%',minimumCountSelected:'2'});
	  $("#auditRndNoLocations").multipleSelect({placeholder:'Select audit round(s)',width: '40%',minimumCountSelected:'2'});
      });
	  
	  
	  
	  
	  
$(function () {
  
  
<?php

	$counter = 0;
	$barData = array();
	$volumeData = array();
	$labNameData = array();
	
	foreach($testingVolume as $row) {
	  if($counter == 10) break;
	  if($row['AUDIT_SCORE_PERCANTAGE'] < 40){
		$color = '#FF0000';
		$level = 0;
	  }else if($row['AUDIT_SCORE_PERCANTAGE'] >= 40 && $row['AUDIT_SCORE_PERCANTAGE'] <60){
		$color = '#FFA500';
		$level = 1;
	  }else if($row['AUDIT_SCORE_PERCANTAGE'] >= 60 && $row['AUDIT_SCORE_PERCANTAGE'] <80){
		$color = '#FFFF00';
		$level = 2;
	  }else if($row['AUDIT_SCORE_PERCANTAGE'] >= 80 && $row['AUDIT_SCORE_PERCANTAGE'] <90){
		$color = '#8DD63E';
		$level = 3;
	  }else if($row['AUDIT_SCORE_PERCANTAGE'] >= 90){
		$color = '#528A16';
		$level = 4;
	  }
	  
	  $levelData[] = "{ y : ".$level. ", color : '".$color."' }"; 
	  $volumeData[] = (isset($row['avgMonthTesting']) ? $row['avgMonthTesting'] : 0); 
	  $testerData[] = (isset($row['NumberofTester']) ? $row['NumberofTester'] : 0); 
	  $labNameData[] = ("'Date : ".$this->humanDateFormat($row['assesmentofaudit'])."<br>' + ' ' + 'Facility Name : ".addslashes($row['facilityname'])." <br> Testing Point Name : ".addslashes($row['testingpointname'])."<br>'"); 
	  $counter++;
	  
	}
?>  
  
  
    $('#volumeChart').highcharts({
        chart: {
            zoomType: 'xy'
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        xAxis: [{
            categories: [<?php echo implode(",",$labNameData); ?>],
            crosshair: true,
			labels:
			{
			  enabled: false
			}
        }],
        yAxis: [{ // Primary yAxis
            labels: {
                format: '{value}',
                style: {
                    color: 'black'
                }
            },
            title: {
                text: 'No. of Testers',
                style: {
                    color: 'black'
                }
            },
            opposite: true

        }, { // Secondary yAxis
            gridLineWidth: 0,
            title: {
                text: 'Level',
                style: {
                    color: Highcharts.getOptions().colors[0]
                }
            },
            labels: {
                format: '{value}',
                style: {
                    color: Highcharts.getOptions().colors[0]
                }
            },
			min : 0,
			max : 4,
            opposite: true

        }, { // Tertiary yAxis
            gridLineWidth: 0,
            title: {
                text: 'Testing Volume',
                style: {
                    color: Highcharts.getOptions().colors[1]
                }
            },
            labels: {
                format: '{value}',
                style: {
                    color: Highcharts.getOptions().colors[1]
                }
            }
        }],
        tooltip: {
            shared: true
        },
        plotOptions: {
            column: {
                pointPadding: 0,
                borderWidth: 0
            }
        },		
        legend: {
            enabled: true
        },
        series: [ {
            name: 'Testing Volume',
            type: 'column',
            yAxis: 2,
            data: [<?php echo implode(",",$volumeData); ?>],
			color: {
			  pattern : "https://raw.githubusercontent.com/highslide-software/pattern-fill/master/graphics/pattern3.png",
			  width: 6,
			  height: 6
			},	
            tooltip: {
                valueSuffix: ' Tests'
            }

        }, {
            name: 'Testers',
            type: 'column',
            data: [<?php echo implode(",",$testerData); ?>],
            tooltip: {
                valueSuffix: ' Tests'
            },
			color: '#3598DC',

        },{
            name: 'Level',
            type: 'column',
            yAxis: 1,
            data: [<?php echo implode(",",$levelData); ?>],
            tooltip: {
                valueSuffix: ' '
            }

        }]
    });
    <?php
		$eventDatesArray = array();
		$eventCount = array();
		foreach($allSubmissions as $row) {
		  $humanDate = $this->humanDateFormat($row['assesmentofaudit']);
		  $eventDatesArray[] = "'".$humanDate."'";
		  if(isset($eventCount[$humanDate])){
			$eventCount[$humanDate] = $eventCount[$humanDate] + 1;
		  }else{
			$eventCount[$humanDate] = 1;
		  }
		  
		  if(count($eventCount) >= 40){
			break;
		  }
		}
		
		$eventDatesArray = array_unique($eventDatesArray);
		
	  
?>  	
	
$('#auditDates').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        xAxis: {
            categories: [<?php echo implode(",",$eventDatesArray); ?>],
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Audit Counts'
            }
        },
		legend :{
		  enabled : false
		},
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b>{point.y:.0f}</b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0
            }
        },
        series: [{
            name: 'Audit Counts',
            data: [<?php echo implode(",",$eventCount); ?>]

        }]
    });	
	
var startDate = "";
    var endDate = "";
    $('.datepicker').daterangepicker({
	    format: 'DD-MMM-YYYY',
	    startDate: moment().subtract('days', 29),
	    endDate: moment(),
	    maxDate: moment(),
	    ranges: {
		'Today': [moment(), moment()],
		'Yesterday': [moment().subtract('days', 1), moment().subtract('days', 1)],
		'Last 7 Days': [moment().subtract('days', 6), moment()],
		'Last 30 Days': [moment().subtract('days', 29), moment()],
		'This Month': [moment().startOf('month'), moment().endOf('month')],
		'Last Month': [moment().subtract('month', 1).startOf('month'), moment().subtract('month', 1).endOf('month')]
	    },
	},
	function(start, end) {
	    startDate = start.format('YYYY-MM-DD');
	    endDate = end.format('YYYY-MM-DD');
	});	
	<?php
	$start_date = date('d-M-Y');
        $end_date = date('d-M-Y', strtotime('-30 days', strtotime($start_date)));
	?>
	$("#spiRTv3").val('<?php echo $end_date." - ".$start_date;?>');
	
});

	  
	  
	  
    </script>