<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/t/bs/jqc-1.12.0,dt-1.10.11,r-2.0.2,sc-1.4.1/datatables.min.css"/>
<style>

 td.details-control {
    background: url('<?php echo $this->basePath('assets/img/details_open.png'); ?>') no-repeat center center;
    cursor: pointer;
}
tr.shown td.details-control {
    background: url('<?php echo $this->basePath('assets/img/details_close.png'); ?>') no-repeat center center;
}
</style> 


<div class="am-content">
        <div class="page-head">
          <h2>SPI RT Version 3</h2>
        </div>
        
        
        <div class="main-content">
            
            <div class="widget widget-fullwidth widget-small" style="padding:5px;">


        <div class="row">
            <div class="col-sm-12">
              <div class="panel panel-default">
                <div class="panel-body">
                  <form role="form">
                    <div class="form-group col-lg-6">
                      <label>Date</label>
                      <input type="text" placeholder="Enter Date" class="form-control">
                    </div>
                    <div class="form-group col-lg-6">
                      <label>Audit Round No.</label>
                      <select class="form-control">
                        <option>--Select--</option>
                          <option>1</option>
                          <option>2</option>
                          <option>3</option>
                          <option>4</option>
                          <option>5</option>
                        </select>
                    </div>
                    <div class="form-group col-lg-6">
                      <label>Type of testing point</label>
                      <select class="form-control">
                        <option>--Select--</option>
                        <option>VCT/HTC</option>          
                        <option>PITC</option>            
                        <option>PMTCT</option>        
                        <option>TB clinic</option>
                        <option>Laboratory</option>
                        <option>Treatment Center</option>
                        <option>Other</option>
                        </select>
                    </div>
                    <div class="form-group col-lg-6">
                      <label>Level</label>
                      <select class="form-control">
                        <option>--Select--</option>
                        <option>Region/Province/Zone</option>         
                        <option>District</option>
                        <option>Referral center</option>
                        <option>Health center</option>
                        <option>Dispensary</option>
                        <option>Health Post</option>
                        <option>Other</option>
                        </select>
                    </div>
                    <div class="form-group col-lg-6">
                      <label>Affiliation</label>
                      <select class="form-control">
                        <option>--Select--</option>
                        <option>Government</option>
                        <option>Private</option>
                        <option>Faith-based Organization</option>
                        <option>Non-governmental organization</option>
                        <option>Other</option>
                        </select>
                    </div>
                    
                    <div class="spacer  col-lg-12">
                      <button type="button" onclick="alert('Under Construction')" class="btn btn-space btn-primary">Search</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
        </div>



                <table id="example" class="table table-bordered table-striped table-hover table-fw-widget">
                  <thead>
                    <tr>
                      <th></th>
                      <th>Facility Name</th>
                      <th>Form ID</th>
                      <th>Form Version</th>
                      <th>Audit Round No.</th>
                      <th>Testing Point Type</th>
                      <th>Level</th>
                      <th>Affiliation</th>
                      <th>Audit Score Percentage</th>
                      <th>Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                  <?php foreach ($allSubmissions as $row) { ?>
                    <tr id="row_<?php echo $row['id']; ?>" data-child-value="<?php echo $row['id']; ?>">
                      <td class="details-control"></td>
                      <td><?php echo $row['facilityname']; ?></td>
                      <td><?php echo $row['formId']; ?></td>
                      <td><?php echo $row['formVersion']; ?></td>
                      
                      <td><?php echo $row['auditroundno']; ?></td>
                      <td><?php echo $row['testingpointtype']; ?></td>
                      <td><?php echo $row['level']; ?> <?php echo (isset($row['level_other']) && $row['level_other'] != "") ? " - ".$row['level_other'] : ""; ?></td>
                      <td><?php echo $row['affiliation']; ?></td>
                      <td><?php echo round($row['AUDIT_SCORE_PERCANTAGE'],2); ?></td>
                      <td><?php echo ucwords($row['status']); ?></td>
                      <td>
                       <a href="/spi-v3/print/<?php echo $row['id']; ?>" target="_blank"><i class="fa fa-print"></i> Print</a>
                       <?php
                       if($row['status']=='pending'){
                       ?>
                       <button type="button" onclick="approveStatus('<?php echo $row['id']; ?>')" class="btn btn-space btn-success">Approve</button>
                       <?php } ?>
                       <!--<button type="button" onclick="downloadPdf('< ?php echo $row['id']; ?>')" class="btn btn-space btn-primary">Download PDF</button>-->
                      </td>
                    </tr>
                    <?php } ?>
                  </tbody>
                </table>


            </div>
        <div class="spacer col-lg-12">
                <button type="button" onclick="window.location.href='<?php echo $this->url('spi-v3-form',array('action'=>'export')); ?>'" class="btn btn-space btn-primary">Export All Data</button>
        </div>
        <br>
        <br>
        <br>
        <br>
            
            
        </div>
</div>
<script type="text/javascript" src="https://cdn.datatables.net/t/bs/jqc-1.12.0,dt-1.10.11,r-2.0.2,sc-1.4.1/datatables.min.js"></script>
<script type="text/javascript">
    var table = null;
    function format(value) {
      return '<a href="/spi-v3/print/'+value+'" target="_blank"><i class="fa fa-print"></i> Print Full Survey</a>'
                        +
                '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
                        + 
             '<a href="javascript:alert(\'Under Construction\')" target="_blank"><i class="fa fa-print"></i> Print Corrective Actions</a>';
  }
  $(document).ready(function () {
      var table = $('#example').DataTable({"order": [[1, 'asc']]});

      // Add event listener for opening and closing details
      $('#example').on('click', 'td.details-control', function () {
          var tr = $(this).closest('tr');
          var row = table.row(tr);

          if (row.child.isShown()) {
              // This row is already open - close it
              row.child.hide();
              tr.removeClass('shown');
          } else {
              // Open this row
              row.child(format(tr.data('child-value'))).show();
              tr.addClass('shown');
          }
      });
  });
  
  function approveStatus(id) {
    conf=confirm("Are you sure,you want approved this form");
    if (conf) {
      $.post("<?php echo $this->url('spi-v3-form',array('action'=>'approve-status')); ?>",{id: id},
       function(data) {
        if (data>0) {
            alert("Form status updated successfully");
            location="";
        }
         
      });
    }
  }
  
  function downloadPdf(formId){
   window.open('<?php echo $this->url('spi-v3-form',array('action' => 'download-pdf'))?>'+formId);
   return false;
  }
</script>